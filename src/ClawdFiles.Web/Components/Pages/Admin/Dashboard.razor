@page "/admin"
@using ClawdFiles.Application.Services
@inject KeyManagementService KeyService
@inject BucketService BucketService
@rendermode InteractiveServer

<PageTitle>Admin Dashboard</PageTitle>

<h1>Admin Dashboard</h1>

<h2>API Keys</h2>
@if (keys is null)
{
    <p>Loading...</p>
}
else
{
    <table>
        <thead><tr><th>Prefix</th><th>Name</th><th>Created</th><th>Last Used</th><th>Buckets</th></tr></thead>
        <tbody>
            @foreach (var key in keys)
            {
                <tr>
                    <td>@key.Prefix</td><td>@key.Name</td>
                    <td>@key.CreatedAt.ToString("u")</td>
                    <td>@(key.LastUsedAt?.ToString("u") ?? "Never")</td>
                    <td>@key.BucketCount</td>
                </tr>
            }
        </tbody>
    </table>
}

<h2>All Buckets</h2>
@if (buckets is null)
{
    <p>Loading...</p>
}
else
{
    <table>
        <thead><tr><th>ID</th><th>Name</th><th>Files</th><th>Created</th><th>Expires</th></tr></thead>
        <tbody>
            @foreach (var b in buckets)
            {
                <tr>
                    <td><a href="/@b.Id">@b.Id</a></td><td>@b.Name</td>
                    <td>@b.FileCount</td>
                    <td>@b.CreatedAt.ToString("u")</td>
                    <td>@(b.ExpiresAt?.ToString("u") ?? "Never")</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private List<ClawdFiles.Application.DTOs.KeyInfoResponse>? keys;
    private List<ClawdFiles.Application.DTOs.BucketListItemResponse>? buckets;

    protected override async Task OnInitializedAsync()
    {
        keys = await KeyService.ListKeysAsync();
        buckets = await BucketService.ListBucketsAsync(null, isAdmin: true);
    }
}
